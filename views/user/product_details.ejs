<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome for Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="userDetails.css">
    <link rel="stylesheet" href="user/detailedProduct.css">
    <link rel="stylesheet" href="/user/header.css">

    <!-- Favicon -->
    <link rel="shortcut icon" href="img/favicon.png" type="image/x-icon">

</head>

<body>
    <!-- Navbar -->
    <%- include('../../views/partials/user/detailsHeader') %>
    
    <main class="product-details">
        
        <div class="container">
            <!-- breadcrumb -->
            <div style="--bs-breadcrumb-divider: url(&#34;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='%236c757d'/%3E%3C/svg%3E&#34;);" aria-label="breadcrumb">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item"><a class="text-primary" href="/">Home</a></li>
                  <li class="breadcrumb-item active" aria-current="page">Library</li>
                </ol>
            </div>
            
            <div class="product-container">
                <div class="product-image-section">
                    <div id="imageZoom" class="mb-2" style="--url: url('/uploads/<%= product.product_imgs[0] %>'); --zoom-x: 0%; --zoom-y: 0%; --opacity: 0">
                        <img id="main-img" src="/uploads/<%= product.product_imgs[0] %>" alt="Book Cover" class="main-image">
                    </div>
                    <div class="thumbnails">
                        
                         <% product.product_imgs.forEach(element => { %>
                          
                        <img onclick="imageAdd('/uploads/<%= element %>')" src="/uploads/<%= element %>" alt="Thumbnail 2">
                            
                        <% }) %>
                    </div>
                </div>
                <div class="product-info-section">
                    <h2 class="product-title fw-bold">
                        <%= product.title %>
                    </h2>
                    <p class="author">
                        <%= product.author_name %>
                    </p>
                    <p class="rating">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="far fa-star"></i>
                        <p><%= review.rating %></p>
                    </p>
                    <ul class="product-details-list">
                        <li><strong>Category: </strong>
                            <%= category.name %>
                        </li>
                        <li><strong>Publishing Date: </strong>
                            <%= product.formattedDate %>
                        </li>
                        <li><strong>Publisher: </strong>
                            <%= product.publisher %>
                        </li>
                        <li><strong>Number of Pages: </strong>
                            <%= product.page %>
                        </li>
                        <li><strong>Language: </strong>
                            <%= product.language %>
                        </li>
                        <li><strong>Status: </strong>
                            <% if (stockState === 'Blocked') { %>
                                <span class="badge bg-secondary">Blocked</span>
                            <% } else if (stockState === 'Sold out') { %>
                                <span class="badge bg-danger">Sold Out</span>
                            <% } else if (stockState === 'Out of stock') { %>
                                <span class="badge bg-danger">Out of Stock</span>
                            <% } else if (stockState === 'Available') { %>
                                <span class="badge bg-success">Available</span>
                            <% } else if (stockState === 'Unavailable') { %>
                                <span class="badge bg-danger">Unavailable</span>
                            <% } else { %>
                                <span class="badge bg-secondary">Unknown Status</span>
                            <% } %>
                        </li>
                    </ul>
                    <p class="price">
                        <%= "₹" +product.price %>
                    </p>
                    
                    <div class="action-buttons">
                    <form action="/addCart" method="post">

                        <input type="hidden" name="product_id" value="<%= product._id %>">

                        <!-- Quantity input -->
                        <input type="number" class="q-inp me-2" id="quantity" name="quantity" value="1" min="1" required oninput="validateQuantity(this)">
                        <input type="hidden" id="max-stock" value="<%= product.available_quantity %>">

                        <button class="add-to-cart">Add to Cart</button>
                    </form>
                        <button class="buy-now">Buy Now</button>
                        <div class="wishlist">
                            <i class="fas fa-heart heart"></i>
                        </div>
                    </div>

                </div>
            </div>
        


            <div class="container rel-con">
                <h2 class="text-center mb-3 fw-bold rel-h2 best ">Related Products</h2>
                <div class="row">
                  <!-- Product Card -->
                  <% relatedProducts.forEach(element=> { %>
                    <div class="col-md-3 mb-4">
                      <div class="card shadow-sm">
                        <a class="text-decoration-none text-dark" href="/productDetails?id=<%= element._id %>">
                        <img src="/uploads/<%= element.product_imgs[0] %>" class="card-img-top" alt="<%= element.title %>">
                        <div class="card-body">
                          <h5 class="card-title fw-bold mb-0 rel">
                            <%= element.title %>
                          </h5>
                          <p class="text-success fw-bold mb-0">₹<%= element.price %>.00</p>
                          <p class="text-muted small">
                            <%= element.author_name %>
                          </p>
                          <p class="text-danger small mb-0">
                            <%= element.status %>
                          </p>
                        </div>
                      </a>
                      </div>
                    </div>
                    <% }) %>
                </div>
              </div>
        </div>
        <!--  -->
    </main>

    <!-- Footer -->
    <footer class="py-4 mt-4">
        <div class="container">
            <div class="row">
                <div class="col-md-3">
                    <h6>Contact</h6>
                    <ul class="list-unstyled">
                        <li><a href="#">Home</a></li>
                        <li><a href="#">Contact us</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h6>Customer Service</h6>
                    <ul class="list-unstyled">
                        <li><a href="#">FAQ</a></li>
                        <li><a href="#">Shipping and Returns</a></li>
                        <li><a href="#">Order Tracking</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h6>About Us</h6>
                    <ul class="list-unstyled">
                        <li><a href="#">FAQ</a></li>
                        <li><a href="#">Shipping and Returns</a></li>
                        <li><a href="#">Order Tracking</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h6>Follow Us</h6>
                    <div>
                        <a href="#"><i class="bi bi-facebook"></i></a>
                        <a href="#"><i class="bi bi-instagram"></i></a>
                        <a href="#"><i class="bi bi-linkedin"></i></a>
                    </div>
                </div>
            </div>
        </div>
    </footer>
</body>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- sweet alert -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        
<% if (success && success.length > 0) { %>
    <script>
        
            Swal.fire({
                icon: 'success',
                title: 'Success!',
                text: '<%= success[0] %>',  // Display the first success message
                showConfirmButton: false,
                timer: 1500,
                customClass: {
                    popup: 'my-swal-popup', // Custom class for the popup
                    title: 'my-swal-title', // Custom class for the title
                    content: 'my-swal-content', // Custom class for the content (text)
                    confirmButton: 'my-swal-btn' // Custom class for the button
                },
            });
    </script>  
    <% } %>

    <% if (error && error.length > 0) { %>
        <script>
            Swal.fire({
                icon: 'error',
                title: 'Error!',
                text: '<%= error[0] %>',
                showConfirmButton: false,
                timer: 2000,
                customClass: {
                    popup: 'my-swal-popup',
                    title: 'my-swal-title',
                    content: 'my-swal-content',
                    confirmButton: 'my-swal-btn'
                },
            })
        </script>
    <% } %>

<script>
    let imageZoom = document.getElementById('imageZoom')
    imageZoom.addEventListener('mousemove', (event) => {
        imageZoom.style.setProperty('--opacity', '1')
        let pointer = {
            x: ( event.offsetX * 100 ) / imageZoom.offsetWidth,
            y: ( event.offsetY * 100 ) / imageZoom.offsetHeight
        }
        imageZoom.style.setProperty('--zoom-x', pointer.x + '%')
        imageZoom.style.setProperty('--zoom-y', pointer.y + '%')

    });
    imageZoom.addEventListener('mouseout', () => {
        imageZoom.style.setProperty('--opacity', '0')
    })

    function imageAdd(img) {
        const imgPath = document.getElementById('main-img')
        imgPath.src = img
    }

    function validateQuantity(input) {
        const maxStock = document.getElementById('max-stock').value
        const enteredQuantity = input.value

        if(enteredQuantity > maxStock) {
            Swal.fire({
                icon: 'error',
                title: 'Error!',
                text: `Only ${maxStock} items are available in stock.`,
                showConfirmButton: false,
                timer: 1500,
                customClass: {
                    popup: 'my-swal-popup',
                    title: 'my-swal-title',
                    content: 'my-swal-content',
                    confirmButton: 'my-swal-btn'
                },
            })
            input.value = maxStock
        }
    }
</script>

</html>